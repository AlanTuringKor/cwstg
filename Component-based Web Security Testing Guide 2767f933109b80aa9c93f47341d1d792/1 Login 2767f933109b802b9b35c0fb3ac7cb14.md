# 1. Login

---

# Kapitel: Login — Authentifizierung, Brute-Force, SQLi, Session handling

**Ziel**

Verifizieren, dass die Login-/Authentifizierungs-Implementation sicher ist: keine Bypass-Wege, Resistenz gegen Brute-Force / Credential-Stuffing, korrekte Session-Erzeugung / Invalidation und sichere Cookie-/Token-Konfiguration.

**Scope / Prüfbereiche**

Input-Validation (username/password), Error-Messages (Account-Enumeration), Rate-Limiting / Lockout, Session Creation / Invalidation, Cookie-Flags (Secure/HttpOnly/SameSite), Session Fixation & Predictability, MFA & Recovery-Flows, Backend-validierung.

**Wichtige WSTG-Mappings (Kurz)**

- SQL-Injection (in Login-Fields) → **WSTG-INPV-05** (Testing for SQL Injection). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection?utm_source=chatgpt.com))
- Account-enumeration / guessable accounts → **WSTG Identity Management → Testing for Account Enumeration**. ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/03-Identity_Management_Testing/04-Testing_for_Account_Enumeration_and_Guessable_User_Account?utm_source=chatgpt.com))
- Weak lockout / brute-force → **WSTG-ATHN-03 (Testing for Weak Lock Out Mechanism)**. ([OWASP](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/README?utm_source=chatgpt.com))
- Bypassing authentication schema / auth-bypass → **WSTG-ATHN-04 (Testing for Bypassing Authentication Schema)**. ([OWASP](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/README?utm_source=chatgpt.com))
- Session management / fixation / cookie attributes → **WSTG-SESS series (WSTG-SESS-01..-09)** (Session Management Schema, Cookie Attributes, Session Fixation, Logout, Timeout, Hijacking). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/?utm_source=chatgpt.com))
- Credentials over channel (TLS) → **WSTG-ATHN-01** (Credentials transported over encrypted channel). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/01-Testing_for_Credentials_Transported_over_an_Encrypted_Channel?utm_source=chatgpt.com))

---

## Testfall 1 — **SQL-Injection in username/password (POST/GET)**

**WSTG Mapping:** WSTG-INPV-05 (SQL Injection). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Intercept login POST (or GET) request with proxy.
2. Test classic boolean payloads in username/password fields: e.g. `admin' OR '1'='1' --` , `' OR '1'='1` .
3. Test time-based payloads where allowed (e.g. `'; WAITFOR DELAY '0:0:5'--` for MSSQL or `pg_sleep(5)` for PostgreSQL) to detect blind SQLi.
4. Run targeted sqlmap if interactive tests indicate injection points (use the recorded request).

**Automation-Hint**

- sqlmap with `r login.req --data="username=^USERNAME^&password=^PASSWORD^"` (use caution & authorization).
- Burp Intruder with payloads for boolean/time-based checks.

**Erwartetes Ergebnis / Beweis**

- Keine DB error messages, keine auth bypass. Time-based payloads do not change response timing. PoC: captured request/response showing rejection or no timing change.

**Schnelle Gegenmaßnahme**

- Prepared statements / parameterized queries, ORM usage, input validation/escaping, least-priv DB accounts.

---

## Testfall 2 — **Auth-Bypass (SQLi, logical tamper, alternate encodings)**

**WSTG Mapping:** WSTG-ATHN-04 (Bypassing Authentication Schema) + WSTG-INPV-05. ([OWASP](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/README?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Versuche auth bypass durch: a) SQLi (wie oben), b) Manipulation/Entfernen von client side checks (z. B. remove JS checks), c) URL/parameter tampering (z. B. `?isAdmin=true`), d) alternative encodings (unicode, URL encoding).
2. Teste authentication cookie/token manipulation: tausche Werte, fälsche claims (nur zum Testen — signatur prüfen).

**Automation-Hint**

- Burp Repeater für schnelle Replay/modify. Scripting für massencodierungen.

**Erwartetes Ergebnis / Beweis**

- Server lässt sich nicht zur Auth-Bypass-Aktion bringen; verifizierbare 401/403 oder redirect zum login. Evidence: intercept + response that blocks action.

**Schnelle Gegenmaßnahme**

- Server-seitige Validierung jeder auth-relevanten Variable; never trust client flags; sign/verify tokens server-side.

---

## Testfall 3 — **Brute-Force / Credential-Stuffing (rate-limits, lockout)**

**WSTG Mapping:** WSTG-ATHN-03 (Weak Lock Out Mechanism); Account enumeration tests (for preparatory enumeration). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/README?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Zuerst Account-Enumeration check: Submit forgot/login for existing vs non-existing identifiers and compare messages/timing.
2. Mit genehmigter Test-liste (seeded credentials) automatisiert viele Login-Versuche pro Account (z. B. hydra, Burp Intruder).
3. Beobachte: HTTP 429/401/403, account lockout messages, CAPTCHA trigger, IP blocking, progressive delay.

**Automation-Hint**

- Hydra / Burp Intruder / custom Python script with backoff. Set rate ≤ production-like to avoid DoS.
- Log response times & status codes.

**Erwartetes Ergebnis / Beweis**

- Protective measures (rate limit, lockout, CAPTCHA) nach definierter Anzahl fehlgeschlagener Versuche; logs showing blocked attempts. PoC: request stream + server responses.

**Schnelle Gegenmaßnahme**

- Implement progressive delays, account lockout policies, IP throttling, CAPTCHA, credential stuffing detection, monitor logs.

---

## Testfall 4 — **Session fixation & session reuse after logout**

**WSTG Mapping:** WSTG-SESS-03 (Session Fixation), WSTG-SESS-06 (Logout functionality). ([Scribd](https://fr.scribd.com/document/505697461/WSTG-Checklist-v4-2?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Setze eine SessionID/Cookie in Browser (or via proxy) **vor** Login (z. B. `session=attackersession123`).
2. Logge dich mit Zielaccount ein — prüfe, ob SessionID weiterverwendet oder neu rotiert wird.
3. Logout: dokumentiere ob Session invalidiert server-seitig (versuche Zugriff mit selben cookie nach logout).

**Automation-Hint**

- Burp + manual cookie edit; kleine scripted tests to attempt reuse.

**Erwartetes Ergebnis / Beweis**

- SessionID wird nach Login rotiert (neue ID) und alte ID invalidiert; nach logout ist Zugriff mit alten SessionID nicht möglich. Evidence: Set-Cookie diff + post-logout request gets 401/403.

**Schnelle Gegenmaßnahme**

- Always rotate session id at privilege changes / auth events, server-side session store invalidation on logout.

---

## Testfall 5 — **Weak session identifiers (predictability, long-lived)**

**WSTG Mapping:** WSTG-SESS-01 / general session management tests. ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Beobachte session token format/entropy (length, charset).
2. Generate multiple sessions (create many accounts or logins) and check for patterns / incrementing values.
3. Check token lifetime / expiry (long TTL).

**Automation-Hint**

- Script to create 100 sessions and calculate entropy / detect patterns.

**Erwartetes Ergebnis / Beweis**

- Tokens appear cryptographically random, unpredictable; token TTL is reasonable; stale tokens expire. Evidence: token samples + entropy analysis.

**Schnelle Gegenmaßnahme**

- Use secure random token generation (CSPRNG), short TTLs, bind sessions to client fingerprint (IP/UA where appropriate).

---

## Testfall 6 — **Missing cookie flags (Secure, HttpOnly, SameSite)**

**WSTG Mapping:** WSTG-SESS-02 (Testing for Cookie Attributes). ([Scribd](https://fr.scribd.com/document/505697461/WSTG-Checklist-v4-2?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Inspect `Set-Cookie` headers on authentication responses.
2. Confirm presence of `Secure`, `HttpOnly` and appropriate `SameSite` attribute. For persistent cookies (remember-me) also check `Expires` and secure storage.

**Automation-Hint**

- Simple curl/wget or Burp to capture response headers; automation: script to fetch auth response and parse cookie headers.

**Erwartetes Ergebnis / Beweis**

- Cookies set with `Secure; HttpOnly; SameSite=Strict/Lax` as appropriate. Evidence: HTTP response headers screenshot/log.

**Schnelle Gegenmaßnahme**

- Enforce cookie flags server-side, mark auth cookies HttpOnly+Secure and choose SameSite policy.

---

## Testfall 7 — **MFA bypass or recovery flow abuse**

**WSTG Mapping:** Authentication tests (MFA-related items are scattered in ATHN sections and recovery tests like Testing for Weak Password Change/Reset). (see WSTG Authentication & Identity Management). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/README?utm_source=chatgpt.com))

**Kurz-Prüfschritte**

1. Test recovery flows (forgot password, magic link): attempt token reuse, long token lifetime, token in URL vs POST.
2. Test MFA recovery (backup codes, SMS reset): attempt brute of one-time codes, request multiple resets to see link reuse or predictable tokens.
3. Attempt forced MFA reset via social engineering points (if in scope: phone, email alternative channels).

**Automation-Hint**

- Script to request many reset emails to evaluate rate-limit; inspect token format/length; test reuse.

**Erwartetes Ergebnis / Beweis**

- Resets are single-use, short TTL, rate limited; backup codes treated as one-time; MFA protected flows require proof of possession. Evidence: intercepted token, reuse attempts fail or expired.

**Schnelle Gegenmaßnahme**

- Enforce single-use short-lived tokens, tie recovery to secondary verified channels, rate limit recovery endpoints, require additional verification for sensitive resets.

---

## Kurze Checkliste (für Reporting / PoC-Felder)

Für jeden gefundenen Problemfall solltest du mindestens loggen/reporten:

- **TestID** (z. B. LOGIN-SQLI-01)
- **WSTG-Ref** (z. B. WSTG-INPV-05). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection?utm_source=chatgpt.com))
- **Schritte zur Reproduktion** (intercept request + payload)
- **Request/Response (raw)** (Beweis)
- **Schwere (CVSS v3.1) + Business Impact**
- **Kurz-Fix (1-line)**
- **Remediation Details** (DB parameterized, session rotation etc.)

---

## Tools & Payload-Beispiele (nur zur genehmigten Testung)

- Tools: Burp Suite (Proxy/Intruder/Repeater), sqlmap (für SQLi PoC), hydra/ffuf for brute/enum, curl/wget for headers, small Python scripts for session entropy tests.
- Beispiel-Payloads (nur in autorisiertem Test):
    - Boolean SQLi: `admin' OR '1'='1' --`
    - Time SQLi (MSSQL): `'; WAITFOR DELAY '0:0:5'--`
    - Basic brute user/password sample list (use curated dataset / explicit permission).

---

## Zusammenfassung (Was du in den Report schreibst)

- Mapping jeder relevanten Schwachstelle zum WSTG-Abschnitt (siehe oben). ([OWASP](https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05-Testing_for_SQL_Injection?utm_source=chatgpt.com))
- Für jeden Test: Kurz-Schritt, PoC (raw req/res), Empfehlungen (konkret: PreparedStatements, rate limiting, cookie flags, session rotation, MFA).
- Priorisierung: Auth-Bypass / SQLi / Session fixation → **High**; Brute-Force (wenn keine Protections) → **High**; Missing cookie flags → **Medium**.

---